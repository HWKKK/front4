# 🚀 NomPangS 온보딩 유저플로우 가이드 v2.2 (Figma 정확 반영)

> **Version**: 2.2  
> **Last Updated**: 2024-12-19  
> **Figma 디자인 정확 반영 - 6단계 완전한 플로우**

## 📋 목차

1. [전체 유저플로우 개요](#-전체-유저플로우-개요)
2. [화면별 상세 플로우](#-화면별-상세-플로우)
3. [데이터 플로우](#-데이터-플로우)
4. [네비게이션 구조](#-네비게이션-구조)
5. [에러 처리 및 예외 상황](#-에러-처리-및-예외-상황)

---

## 🎯 전체 유저플로우 개요

### **Figma 정확 반영 6단계 플로우**
```
앱 시작 → 온보딩 인트로 → 기본 정보 입력 → 용도 입력 → 
사진 촬영 → 캐릭터 생성 로딩 → 성격 조정 → 캐릭터 완료
```

### **6단계 온보딩 플로우 (Figma 정확)**
| 단계 | 화면명 | Figma ID | 주요 기능 | 예상 시간 |
|------|--------|----------|----------|----------|
| **1** | 온보딩 인트로 | `38:5961` | 서비스 소개 | 30초 |
| **2** | 사물 정보 입력 | `38:6025` | 이름, 위치, 기간, 사물종류 | 1분 |
| **3** | 사물의 용도 입력 | `38:6207` | 용도 + 유머스타일 | 1분 |
| **4** | 사진 촬영 | `38:5998` | 카메라/갤러리 | 30초 |
| **5** | 캐릭터 생성 로딩 | `38:5818` | AI 처리 중 로딩 | 10-30초 |
| **6** | 성격 조정 | `38:5765` | 3가지 슬라이더 조정 | 1-2분 |
| **완료** | 캐릭터 생성 완료 | `38:5701` | QR 코드 + 대화 시작 | 확인 |

### **화면 제목 매핑 (Figma 정확)**
- **Step 1**: "지금부터 당신의 애착 사물을 깨워볼께요."
- **Step 2**: "궁금해! 나는 어떤 사물이야?"
- **Step 3**: "{사물이름} 라니..! 😂 너에게 나는 어떤 존재야?"
- **Step 4**: "내장 카메라 UI"
- **Step 5**: "캐릭터 깨우는 중..." → "개성을 찾고 있어요" → "마음을 열고 있어요"
- **Step 6**: "성격은 고쳐쓰는거야~ 수줍음 한 스푼.."
- **완료**: "{사물}이 깨어났어요!" + QR 코드 블록

---

## 📱 화면별 상세 플로우

### **1. 온보딩 인트로 화면**
`/onboarding/intro` | `OnboardingIntroScreen` | Figma: `38:5961`

#### **화면 목적**
- 서비스 컨셉 소개: "지금부터 당신의 애착 사물을 깨워볼께요"
- 캐릭터 프리뷰로 기대감 형성

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 |
|------|------|------|
| **메인 타이틀** | "지금부터 당신의 애착 사물을 깨워볼께요." | 서비스 소개 |
| **캐릭터 갤러리** | 3개 회전하는 이미지 | 기대감 조성 |
| **CTA 버튼** | "캐릭터 깨우기" | 다음 단계 진행 |
| **건너뛰기** | 우상단 | 홈으로 바로 이동 |

---

### **2. 사물 정보 입력 화면**
`/onboarding/input` | `OnboardingInputScreen` | Figma: `38:6025`

#### **화면 목적**
- 애착 사물의 기본 정보 수집 (4가지 필수 정보)

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 필수 여부 | Figma 예시 |
|------|------|----------|-----------|
| **메인 타이틀** | "궁금해! 나는 어떤 사물이야?" | - | - |
| **이름 입력** | 파란색 버블 + 텍스트필드 | ✅ 필수 | "털찐 말랑이" |
| **위치 선택** | 드롭다운 | ✅ 필수 | "사무실에서" |
| **기간 선택** | 드롭다운 | ✅ 필수 | "3개월 정도 함께한" |
| **사물 종류** | 텍스트필드 | ✅ 필수 | "이 빠진 머그컵(이)에요." |

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| ✅ "다음" 버튼 터치 | → 용도 입력 화면 이동 | 4개 필드 모두 입력 완료 |
| ❌ "다음" 버튼 터치 | 에러 메시지 표시 | 필수 필드 누락 |
| ◀️ 뒤로가기 터치 | → 인트로 화면 이동 | 항상 |

---

### **3. 사물의 용도 입력 화면**
`/onboarding/purpose` | `OnboardingPurposeScreen` | Figma: `38:6207`

#### **화면 목적**
- 사물의 역할과 유머스타일 설정으로 캐릭터 성격 기반 구축

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 | Figma 예시 |
|------|------|------|-----------|
| **캐릭터 이름 표시** | "{사물이름} 라니..! 😂" | 개인화 | "털찐 말랑이 라니..! 😂" |
| **질문 타이틀** | "너에게 나는 어떤 존재야?" | 역할 질문 | - |
| **캐릭터 말풍선** | 초록색 버블 | 용도별 예시 대화 | "내가 운동 까먹지 않게 인정사정없이 채찍질해줘. 착하게 굴지마. 너는 조교야." |
| **유머스타일 선택** | 드롭다운 | 5가지 스타일 | "위트있는 유머 스타일" |

#### **🎯 용도 입력 (자유 텍스트)**
```
텍스트 에리어: "내가 운동 까먹지 않게 인정사정없이 채찍질해줘. 착하게 굴지마. 너는 조교야."
- 최대 300자
- 구체적인 역할 및 상호작용 방식 기술
- 실시간으로 말풍선에 반영
```

#### **🎭 유머 스타일 (5가지 - Figma 확인)**
```
1. 따뜻한
2. 날카로운 관찰자적
3. 위트있는 ← 선택됨
4. 자기비하적
5. (추가 옵션)
```

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| 📝 용도 입력 | → 말풍선 실시간 업데이트 | 항상 |
| 🎭 유머스타일 선택 | → 말풍선 톤 변경 | 항상 |
| ✅ "다음" 버튼 터치 | → 사진 촬영 화면 이동 | 용도 입력 + 유머 선택 완료 |

---

### **4. 사물 사진 촬영 화면**
`/onboarding/photo` | `OnboardingPhotoScreen` | Figma: `38:5998`

#### **화면 목적**
- 사물의 물리적 특성 수집으로 멀티모달 AI 분석 지원

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 |
|------|------|------|
| **메인 타이틀** | "내장 카메라 UI" | 행동 유도 |
| **카메라 프리뷰** | 전체 화면 크기 | 실시간 뷰파인더 |
| **카메라 아이콘** | 중앙 배치 | 촬영 기능 안내 |

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| 📸 촬영 버튼 터치 | → 미리보기 화면 | 카메라 권한 있음 |
| 🖼️ 갤러리 선택 | → 이미지 선택 | 저장소 권한 있음 |
| ✅ "이 사진으로 계속하기" | → 캐릭터 생성 로딩 화면 | 이미지 품질 통과 |
| ⏭️ "사진 없이 계속하기" | → 캐릭터 생성 로딩 화면 | 항상 |

---

### **5. 캐릭터 생성 로딩 화면 ⭐**
`/onboarding/generation` | `OnboardingGenerationScreen` | Figma: `38:5818`

#### **화면 목적**
- **AI 처리 과정 시각화 및 사용자 몰입감 조성**
- **3단계 생성 과정을 순차적으로 표시**

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 | Figma 예시 |
|------|------|------|-----------|
| **메인 로딩 애니메이션** | 플로팅 버블들 + 중앙 원형 | 생성 진행 표시 | 복잡한 원형 애니메이션 |
| **단계별 메시지** | 3가지 순차 표시 | 진행 상황 알림 | "캐릭터 깨우는 중..." |
| **프로그레스 바** | 하단 진행률 | 시각적 진행도 | 20% → 100% |

#### **🔄 3단계 생성 과정 (Figma 정확)**
```
Stage 1: "캐릭터 깨우는 중..." (0-30%)
- 기본 분석 시작

Stage 2: "개성을 찾고 있어요" (30-70%) 
- 성격 특성 분석

Stage 3: "마음을 열고 있어요" (70-100%)
- 최종 캐릭터 생성 완료
```

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| ⏳ 자동 진행 | → 성격 조정 화면 자동 이동 | 100% 완료 시 |
| ⏭️ "건너뛰기" | → 성격 조정 화면 즉시 이동 | 항상 |

---

### **6. 성격 조정 화면**
`/onboarding/personality` | `OnboardingPersonalityScreen` | Figma: `38:5765`

#### **화면 목적**
- **AI 생성된 초기 성격을 3가지 슬라이더로 미세 조정**
- **실시간 성격 변화 피드백 제공**

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 | Figma 예시 |
|------|------|------|-----------|
| **캐릭터 이미지** | 우상단 마스크 그룹 | 시각적 피드백 | 원형 마스크 캐릭터 |
| **성격 슬라이더 3개** | 수직 배치 | 실시간 조정 | 3가지 색상 구분 |
| **순환 텍스트** | 캐릭터 주변 원형 | 성격 설명 | "성격은 고쳐쓰는거야~ 수줍음 한 스푼.." |
| **완료 버튼** | "성격 저장하기" | 다음 단계 진행 | - |

#### **🎚️ 3가지 성격 슬라이더 (Figma 정확)**
| 슬라이더 | 색상 | 범위 | 설명 | Figma 예시 |
|----------|------|------|------|-----------|
| **내외향성** | 노란색 | 수줍음 ↔ 활발함 | 사회적 성향 | 왼쪽 끝 설정 |
| **감정표현** | 주황색 | 차가움 ↔ 따뜻함 | 감정 표현 방식 | 중간 설정 |
| **유능함** | 초록색 | 서툼 ↔ 능숙함 | 능력 자신감 | 오른쪽 끝 설정 |

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| 🎚️ 슬라이더 조정 | → 실시간 캐릭터 변화 | 항상 |
| ✅ "성격 저장하기" | → 캐릭터 완료 화면 | 항상 |
| 🔄 "기본값으로 되돌리기" | → AI 추천값 복원 | 항상 |

---

### **완료. 캐릭터 생성 완료 화면 ⭐**
`/onboarding/complete` | `OnboardingCompleteScreen` | Figma: `38:5701`

#### **화면 목적**
- **QR 코드 생성 및 캐릭터 첫 대화**
- **사용법 안내 및 대화 시작**

#### **UI 구성요소** (Figma 정확 반영)
| 요소 | 스펙 | 기능 | Figma 예시 |
|------|------|------|-----------|
| **타이틀** | "{사물}이 깨어났어요!" | 완료 축하 | "털찐 말랑이가 깨어났어요!" |
| **QR 코드 블록** | 분홍색 배경 + QR 이미지 | 딥링크 생성 | 중앙 배치 QR |
| **QR 설명** | "QR을 붙이면 언제 어디서든 대화할 수 있어요!" | 사용법 안내 | - |
| **캐릭터 정보** | 이름, 나이, 역할, 위치 | 요약 정보 | "털찐 말랑이, {25}년생, 멘탈지기" |
| **첫 대화 버블** | 초록색 플로팅 버블 | 첫 인사말 | "가끔 털이 엉킬까봐 걱정돼 :(" |
| **해시태그** | "#심신미약 #소심이" | 성격 태그 | - |
| **메인 CTA** | "지금 바로 대화해요" | 홈 화면 이동 | 파란색 버튼 |

#### **🎯 QR 코드 기능 (Figma 확인)**
```
QR 데이터: 딥링크 URL + 캐릭터 ID
기능: 
- 저장하기 버튼
- 공유하기 버튼  
- 물리적 부착용
```

#### **User Actions & 결과**
| 액션 | 결과 | 조건 |
|------|------|------|
| 💬 "지금 바로 대화해요" | → 홈 화면 (대화 시작) | 항상 |
| 💾 "저장하기" | → QR 이미지 저장 | 저장소 권한 |
| 📤 "공유하기" | → QR 공유 시트 | 항상 |
| ◀️ 뒤로가기 | → 성격 조정 화면 | 수정 가능 |

---

## 💾 데이터 플로우 (6단계 정확)

### **수집되는 전체 데이터**
```typescript
interface OnboardingData {
  // Step 2: 기본 정보
  nickname: string;           // "털찐 말랑이"
  location: string;          // "사무실"
  duration: string;          // "3개월"
  objectType: string;        // "이 빠진 머그컵"
  
  // Step 3: 용도/유머
  purpose: string;           // 자유 텍스트 (최대 300자)
  humorStyle: string;        // 5가지 중 선택
  
  // Step 4: 이미지
  photoPath?: string;        // 촬영/선택된 사진 경로
  photoData?: string;        // Base64 (AI 전송용)
  
  // Step 5: AI 생성 (로딩 중 생성)
  aiGenerated: {
    initialPersonality: PersonalityScore;
    characterGreeting: string;
    visualTraits: string[];
  };
  
  // Step 6: 최종 성격 (사용자 조정)
  finalPersonality: {
    introversion: number;     // 1-10 (내외향성)
    warmth: number;          // 1-10 (감정표현)  
    competence: number;      // 1-10 (유능함)
    userAdjusted: boolean;   // 사용자가 수정했는지
  };
  
  // 완료 단계: QR 생성
  qrCode: {
    deepLinkUrl: string;     // 생성된 딥링크
    qrImagePath: string;     // QR 이미지 파일 경로
  };
  
  // 메타데이터
  createdAt: string;
  completedAt: string;
  totalDuration: number;     // 전체 소요 시간 (초)
}
```

---

## 🗺️ 네비게이션 구조 (6단계)

### **완전한 6단계 라우팅**
```
📁 App Root (initialRoute: '/onboarding/intro')
├── 🧭 /onboarding/intro → OnboardingIntroScreen (Step 1)
├── 📝 /onboarding/input → OnboardingInputScreen (Step 2)
├── 🎯 /onboarding/purpose → OnboardingPurposeScreen (Step 3)
├── 📸 /onboarding/photo → OnboardingPhotoScreen (Step 4)
├── ⏳ /onboarding/generation → OnboardingGenerationScreen (Step 5) ⭐
├── 🎭 /onboarding/personality → OnboardingPersonalityScreen (Step 6)
├── ✅ /onboarding/complete → OnboardingCompleteScreen (완료) ⭐
└── 🏡 /home → HomeScreen
```

### **데이터 전달 체인**
```
Step 1 (Intro) → Step 2 (Input)
                    ↓ {nickname, location, duration, objectType}
Step 2 (Input) → Step 3 (Purpose) 
                    ↓ + {purpose, humorStyle}
Step 3 (Purpose) → Step 4 (Photo)
                    ↓ + {photoPath, photoData}
Step 4 (Photo) → Step 5 (Generation) ⭐
                    ↓ + {aiGenerated} (AI 처리 결과)
Step 5 (Generation) → Step 6 (Personality)
                    ↓ + {finalPersonality}
Step 6 (Personality) → Complete (QR 생성) ⭐
                    ↓ + {qrCode}
Complete → Home (캐릭터 사용 시작)
```

---

## ⚠️ 에러 처리 및 예외 상황

### **Step 5: 캐릭터 생성 로딩 특별 처리**
| 에러 상황 | 메시지 | 처리 방법 |
|----------|--------|----------|
| AI 서버 연결 실패 | "잠시 후 다시 시도해주세요" | 재시도 버튼 + 기본값 제공 |
| 이미지 분석 실패 | "사진 없이 캐릭터를 만들어볼게요" | 텍스트 기반 생성으로 전환 |
| 타임아웃 (30초 초과) | "조금 더 시간이 필요해요" | 프로그레스 바 연장 |

### **완료 단계: QR 생성 에러**
| 에러 상황 | 메시지 | 처리 방법 |
|----------|--------|----------|
| QR 생성 실패 | "QR 코드를 만들 수 없어요" | 재생성 버튼 + 대화는 가능 |
| 저장 권한 거부 | "설정에서 저장 권한을 허용해주세요" | 설정 앱 연결 |

---

## 🎯 구현 우선순위 (Figma 정확 반영)

### **Phase 1: 기존 수정 + 누락 화면 (Week 1-2)**
1. **Step 3: 용도 입력 화면 신규 개발**
2. **Step 4: 사진 촬영 화면 신규 개발** 
3. **Step 5: 캐릭터 생성 로딩 화면 신규 개발** ⭐
4. **완료: 캐릭터 완료 + QR 생성 화면 신규 개발** ⭐

### **Phase 2: AI 연동 + 통합 (Week 3)**
1. **AI 생성 API 연동** (Step 5)
2. **QR 코드 생성 및 딥링크** (완료 단계)
3. **전체 플로우 통합 테스트**

### **성공 지표**
- **6단계 완주율**: > 80%
- **평균 완료 시간**: < 4분 
- **QR 코드 생성 성공률**: > 95%
- **사용자 만족도**: > 4.0/5.0

---

**🎯 Figma 디자인에 정확히 맞춘 6단계 완전한 온보딩 플로우입니다. 로딩 화면, QR 코드 생성, 캐릭터 완료 화면이 모두 포함되어 있습니다.** 